<!DOCTYPE html>
<!--
  ~ Copyright (c) 2017 RockScript.io.
  ~ Licensed to the Apache Software Foundation (ASF) under one
  ~ or more contributor license agreements.  See the NOTICE file
  ~ distributed with this work for additional information
  ~ regarding copyright ownership.  The ASF licenses this file
  ~ to you under the Apache License, Version 2.0 (the
  ~ "License"); you may not use this file except in compliance
  ~ with the License.  You may obtain a copy of the License at
  ~
  ~   http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an
  ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~ KIND, either express or implied.  See the License for the
  ~ specific language governing permissions and limitations
  ~ under the License.
  -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RockScript API</title>
  <style>
    @font-face {
      font-family: 'Roboto Slab';
      font-style: normal;
      font-weight: 300;
      src: local('Roboto Slab'), local('RobotoSlab'), url(fonts/roboto-slab-300.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215;
    }
    @font-face {
      font-family: 'Open Sans';
      font-style: normal;
      font-weight: 400;
      src: local('Open Sans Regular'), local('OpenSans-Regular'), url(fonts/open-sans-400.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215;
    }
    @font-face {
      font-family: 'Open Sans';
      font-style: normal;
      font-weight: 700;
      src: local('Open Sans Bold'), local('OpenSans-Bold'), url(fonts/open-sans-700.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215;
    }
  </style>

  <style>
    body {
      font-family: "Open Sans";
      letter-spacing: -.3px;
      margin: 0;
      height: 100%;
    }

    h1, h2, h3, h4, h5, h6 {
      margin-top: 0;
    }

    h1 { font-size: 1.6em; }
    h2 { font-size: 1.4em; }
    h3 { font-size: 1.3em; }
    h4 { font-size: 1.2em; }
    h5 { font-size: 1.15em; }
    h6 { font-size: 1.10em; }

    a:not([href]) {
      cursor: pointer;
    }

    a, a:visited {
      text-decoration: none;
      font-weight: bold;
      color: #1a90bf;
    }

    a:hover {
      text-decoration: underline;
    }

    code {
      font-weight: bold;
      color: #444;
    }

    table {
      border-collapse: collapse;
    }

    tr {
      border: solid;
      border-width: 1px 0;
      border-color: #cacaca;
    }

    tr:first-child {
      border-top: none;
    }

    tr:last-child {
      border-bottom: none;
    }

    thead {
      border-bottom: 1px solid #cacaca;
    }

    th {
      white-space: nowrap;
      text-align: left;
      color: #777;
    }

    th, td {
      padding: 7px 20px 7px 0px;
      vertical-align: top;
    }

    .titlebar {
      background-color: #2B7191 !important;
      color: white;
      padding: 15px;
    }

    .titlebar > .brand {
      font-family: "Roboto Slab";
      display: inline-block;
      opacity: .7;
      margin-right: 30px;
    }

    .titlebar > .title {
      font-size: 1.3em;
      display: inline-block;
    }

    .toc {
      width: 100%;
      padding: 15px 0 0 15px;
      float: left;
    }

    @media (min-width: 800px) {
      .toc {
        width: 200px;
        border-width: 0 1px 0 0;
      }
    }

    .section {
      margin-bottom: 10px;
    }

    .section > .title {
      font-size: 1.1em;
      margin-bottom: 4px;
    }

    .section > .link {
      display: block;
      padding-left: 10px;
    }

    a.link:hover {
      color: #275c7a;
    }

    .content {
      padding: 15px;
      width: calc(100% - 30px);
      float: right;
      border: solid 0 #ddd;
      border-width: 1px 0 0 0;
    }

    @media (min-width: 800px) {
      .content {
        width: calc(100% - 247px);
        border-width: 0 0 0 1px;
        min-height: calc(100vh - 89px);
      }
    }

    .content pre code {
      background-color: #fffcf8;
      border: 1px solid #ddd;
      padding: 7px 10px 7px 10px;
      display: block;
    }

    .hidden {
      display: none;
    }
  </style>

  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="js/showdown-1.8.2.min.js"></script>

  <script type="application/javascript">
    var converter = new showdown.Converter({tables: 'true'});

    window.addEventListener('load', function() {

      // Render the markdown to HTML below in this file
      $('.content').children().each(function(){
        let contentChild = $(this);
        let contentMarkdown = contentChild.html();
        contentChild.html(converter.makeHtml(contentMarkdown));
      });

      // Get the commands and queries documentation data from the server
      $.get('http://localhost:3652/docs', function(docs) {
        // Render and add the commands Table Of Contents
        let commandsTocHtml =
            '<div class="title">Commands</div>' +
            docs.commands.map(function(command) {
              return '<a class="link" onclick="show(\'command-'+command.type+'\')">'+command.label+'</a>';
            }).join('');
        $('#commands').html(commandsTocHtml);

        // Render and add the queries Table Of Contents
        let queriesTocHtml =
            '<div class="title">Queries</div>' +
            docs.queries.map(function(query) {
              return '<a class="link" onclick="show(\'query-'+query.type+'\')">'+query.label+'</a>';
            }).join('');
        $('#queries').html(queriesTocHtml);

        // Render the command and query content sections
        var contentHtml =
            docs.commands.map(function(command) {
              return '<div id="command-'+command.type+'" class="hidden"> \n' +
                '<h1>'+command.label+'</h1> \n'+
                converter.makeHtml(command.content)+'\n'+
                '</div>';
              }).join('\n')+
            docs.queries.map(function(query) {
              return '<div id="query-'+query.type+'" class="hidden"> \n' +
                '<h1>'+query.label+'</h1> \n'+
                converter.makeHtml(query.content)+'\n'+
                '</div>';
            }).join();
        $('.content').append(contentHtml);
      });
    });

    function show(id) {
      $('.content').children().addClass("hidden");
      $('#'+id).removeClass("hidden");
    }
  </script>
</head>
<body>

<a onclick="show('introduction')">
  <div class="titlebar">
    <div class="brand"><img alt="RockScript.io" src="img/hand-white.png" height="16">RockScript.io</div>
    <div class="title">RockScript API documentation</div>
  </div>
</a>

<div class="toc">
  <div class="section">
    <div class="title">General</div>
    <a class="link" onclick="show('introduction')">Introduction</a>
    <a class="link" onclick="show('authentication')">Authentication</a>
    <a class="link" onclick="show('help')">Help</a>
  </div>
  <div id="commands" class="section">
  </div>
  <div id="queries" class="section">
  </div>
</div>

<div class="content">

<div id="introduction">
# RockScript API documentation

The RockScript API is a HTTP API that consists of
* Commands
* Queries

### Commands

Commands are RPC style operations that change the state of the RockScript server.
Commands are invoked by a HTTP POST to `http://localhost:3652/command` with the command
JSON as the body.  We hope to add message based API later.
Commands have a the following JSON serialization form
(aka [wrapper object](https://fasterxml.github.io/jackson-annotations/javadoc/2.9/com/fasterxml/jackson/annotation/JsonTypeInfo.As.html#WRAPPER_OBJECT)):
```
{"commandName": { ...command data fields... }}
```
Example of a command request/response:
```
&gt; POST http://localhost:3652/command
  { "saveScript":
    {
      "scriptName": "My first script",
      "scriptText": "var v = 42;"
    }
  }

&lt; HTTP/1.1 200 OK
  Access-Control-Allow-Origin: *
  Content-Type: application/json
  { "id":"sv1",
    "scriptId":"s1",
    "name":"My first script",
    "version":1,
    "text":"var v = 42;"
  }
```
### Queries
Queries fetch data without changing the state of the server.
</div>

<div id="authentication" class="hidden">
# Authentication
At this time RockScript does not yet support any form of authentication.
</div>

<div id="help" class="hidden">
#Help
Please use [GitHub issues as our forum](https://github.com/rockscript/rockscript/issues).

Don't hesitate to ask your questions.
And if you're advanced, don't be shy and help out answering other people's questions.
</div>

</div> <!-- end of content ->

</body>
</html>